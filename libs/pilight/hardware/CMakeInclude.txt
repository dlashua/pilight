list(REMOVE_ITEM ${PROJECT_NAME}_headers "${PROJECT_SOURCE_DIR}/hardware_init.h")
list(REMOVE_ITEM ${PROJECT_NAME}_headers "${PROJECT_SOURCE_DIR}/hardware_header.h")

set(headers)
foreach(header ${${PROJECT_NAME}_headers})
	string(REPLACE ${PROJECT_SOURCE_DIR} "	#include \"../hardware" header1 ${header}) 
	string(REPLACE ".h" ".h\"!" header2 ${header1})
	list(APPEND headers ${header2})
endforeach(header)

string(REPLACE "!" "\n" header4 ${headers})
set(HARDWARE_HEADERS ${header4})
configure_file(${PROJECT_SOURCE_DIR}/hardware_header.h.in ${PROJECT_SOURCE_DIR}/hardware_header.h)	

foreach(source ${${PROJECT_NAME}_sources})
	file(READ ${source} TMP)
	string(REGEX MATCH "void[ ]+[A-Za-z0-9]+Init\\([a-z]+\\)[ ]+{\n" MATCHES "${TMP}")
	list(APPEND hardware_init "${MATCHES}")
endforeach(source)

set(inits)
foreach(init ${hardware_init})
	string(REPLACE "void " "	" init1 ${init})
	string(REPLACE "(void) {" "()!" init2 ${init1})
	list(APPEND inits ${init2})
endforeach(init)

string(REPLACE "!" ";" init4 ${inits})
set(HARDWARE_INIT ${init4})
configure_file(${PROJECT_SOURCE_DIR}/hardware_init.h.in ${PROJECT_SOURCE_DIR}/hardware_init.h)	
